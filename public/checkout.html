<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Super Lure Checkout</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  input, button { padding: 8px; margin: 5px 0; width: 200px; }
  .rates { margin-top: 20px; }
  .rate-item { margin-bottom: 10px; }
</style>
</head>
<body>

<h2>Checkout</h2>

<label for="postalCode">Enter your postal code:</label><br>
<input type="text" id="postalCode" placeholder="e.g. M5V1K2">
<button id="getRatesBtn">Get Shipping Rates</button>

<div class="rates" id="rates"></div>

<script>
document.getElementById('getRatesBtn').addEventListener('click', async () => {
  const postalCode = document.getElementById('postalCode').value.trim();
  if (!postalCode) {
    alert('Please enter your postal code!');
    return;
  }

  const ratesContainer = document.getElementById('rates');
  ratesContainer.innerHTML = 'Loading...';

  try {
    const response = await fetch('/api/canadapost-rate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        postalCode,
        weight: 0.015,  // 15g
        length: 15,     // cm
        width: 5,       // cm
        height: 10      // cm
      })
    });

    const data = await response.json();
    if (!data.success) throw new Error(data.error);

    ratesContainer.innerHTML = '';
    data.shippingRates.forEach(rate => {
      const div = document.createElement('div');
      div.className = 'rate-item';
      div.innerHTML = `
        <strong>${rate.service}</strong>: $${rate.due.toFixed(2)}<br>
        Expected delivery: ${rate.expectedDelivery}
      `;
      ratesContainer.appendChild(div);
    });

  } catch (err) {
    ratesContainer.innerHTML = 'Failed to get shipping rates. Try again.';
    console.error(err);
  }
});
</script>

</body>
</html>
