<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout</title>
</head>
<body>
<h2>Checkout</h2>
<label>Enter your postal code:</label>
<input type="text" id="postalCode" placeholder="e.g., M5V1K2">
<button id="getRates">Get Shipping Rates</button>

<div id="rates"></div>

<script>
document.getElementById('getRates').addEventListener('click', async () => {
  const postalCode = document.getElementById('postalCode').value;
  const res = await fetch('/api/canadapost-rate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ postalCode })
  });

  const data = await res.json();
  const ratesDiv = document.getElementById('rates');
  if (data.success) {
    ratesDiv.innerHTML = data.shippingRates.map(r => 
      `<p>${r.service}: $${r.due.toFixed(2)} (Delivery: ${r.expectedDelivery})</p>`
    ).join('');
  } else {
    ratesDiv.innerHTML = `<p>Failed to get shipping rates. Try again.</p>`;
  }
});
</script>
</body>
</html>
